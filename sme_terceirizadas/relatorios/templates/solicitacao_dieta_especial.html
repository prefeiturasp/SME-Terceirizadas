{% extends 'cabecalho_rodape_solicitacao.html' %}
{% load index %}
{% load static %}
{% load sass_tags %}

{% block conteudo %}
  <div class="conteudo tabela-sem-borda">
  {% include "bloco_fluxo_status_homologacao.html" %}
    {% include "bloco_cabecalho_solicitacao_partindo_escola.html" %}
    <div class="bloco-pescritor-dieta-especial">
      <h5>Descrição da solicitação</h5>
      <table>
        <tr>
          {% if solicitacao.tipo_solicitacao == 'ALUNO_NAO_MATRICULADO'%}
            <th class="w-25">CPF do Aluno</th>
          {%else%}
            <th class="w-25">Cód. EOL do Aluno</th>
          {%endif%}
          <th class="w-50">Nome completo do Aluno</th>
          <th class="w-25">Data de nascimento</th>
        </tr>
        <tr>
          {% if solicitacao.tipo_solicitacao == 'ALUNO_NAO_MATRICULADO'%}
            <td>{{ solicitacao.aluno.cpf|default:'' }}</td>
          {%else%}
            <td>{{ solicitacao.aluno.codigo_eol }}</td>
          {%endif%}
            <td>{{ solicitacao.aluno.nome }}</td>
            <td>{{ solicitacao.aluno.data_nascimento }}</td>
        </tr>
      </table>
      <hr/>
    </div>

    {% if solicitacao.tipo_solicitacao == 'ALUNO_NAO_MATRICULADO' %}
      <div class="bloco-pescritor-dieta-especial">
          <table>
            <tr>
              <th class="w-25">CPF do Responsável</th>
              <th class="w-75">Nome completo do Responsável</th>
              <th/>
            </tr>
          {%for responsavel in solicitacao.aluno.responsaveis.all %}
            <tr>
              <td>{{ responsavel.cpf|default:'' }}</td>
              <td>{{ responsavel.nome }}</td>
            </tr>
            <tr/>
          {% endfor %}
        </table>
          <hr/>
        </div>
    {% endif %}

    <div class="bloco-pescritor-dieta-especial">
      <table>
        <tr>
          <th class="w-50">Nome do Pescritor</th>
          <th class="w-50">Registro Funcional</th>
        </tr>
        <tr>
          <td>{{ solicitacao.nome_completo_pescritor }}</td>
          <td>{{ solicitacao.registro_funcional_pescritor }}</td>
        </tr>
      </table>
      <hr />
       <table>
        <tr>
          <th class="w-50">
            Período de Vigência<br/>
            Data de início
          </th>
          <th class="w-50">Data de término</th>
        </tr>
        <tr>
          <td>{{ solicitacao.data_inicio|date:"SHORT_DATE_FORMAT"|default:'Sem data de início' }}</td>
          <td>{{ solicitacao.data_termino|date:"SHORT_DATE_FORMAT"|default:'Sem data de término' }}</td>
        </tr>
      </table>
      <hr />
      {% if solicitacao.observacoes %}
          <h5>Observações</h5>
          <p>{{ solicitacao.observacoes|safe }}</p>
          </hr>
      {% endif %}

      <table>
        <tr>
          <th class="w-50">Motivo da alteração</th>
          <th class="w-50">Observações da alteração</th>
        </tr>
        <tr>
          <td>{{ solicitacao.motivo_alteracao_ue.nome }}</td>
          <td>{{ solicitacao.observacoes_alteracao|striptags|safe|default:'' }}</td>
        </tr>
      </table>
      <hr/>
    </div>
    <div class="bloco-relacao-por-diagnostico">
        {% if solicitacao.alergias_intolerancias.exists %}
          <h5>Relação por diagnóstico</h5>
            {% for alergia in solicitacao.alergias_intolerancias.all %}
              <p>{{ alergia }}</p>
              <hr/>
            {% endfor %}
        {% endif %}
    </div>
    <div class="classificacao-dieta">
        {% if solicitacao.classificacao %}
          <h5>Classificação da Dieta</h5>
          <label>
            <i class="fa fa-fw fa-check-circle"></i>{{ solicitacao.classificacao.nome }}
          </label>
        {% endif %}
    </div>
    <div class="bloco-pescritor-dieta-especial">
        {% if solicitacao.alergias_intolerancias.all %}
          <h5>Protocolo da Dieta Especial</h5>
            {% for alergia in solicitacao.alergias_intolerancias.all %}
              <p style="text-transform: uppercase">{{ alergia.descricao }}</p>
            {% endfor %}
        {% endif %}
    </div>
    {% if solicitacao.escola.tipo_gestao.nome == 'MISTA' or solicitacao.escola.tipo_gestao.nome == 'PARCEIRA' or solicitacao.escola.tipo_gestao.nome == 'DIRETA' %}
    <div class="bloco-identificacao-nutri tabela-sem-borda">
      <h5>Substituições</h5>
      <table>
        <thead>
          <tr>
            <th>Alimento</th>
            <th>Tipo</th>
            <th>Isenção/Substituição</th>
          </tr>
        </thead>
        <tbody>
          {% for substituicao in solicitacao.substituicoes %}
            <tr>
              <td>{{ substituicao.alimento }}</td>
              <td className="tipo">
                {% if substituicao.tipo == 'I' %}
                  Isenção
                {% elif substituicao.tipo == 'S' %}
                  Substituição
                {% endif %}
              </td>
              <td>
                {% if substituicao.substitutos.all %}
                  {{ substituicao.substitutos.all|join:", " }}
                {% else %}
                  {{ substituicao.alimentos_substitutos.all|join:", " }}
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
      <div class="bloco-identificacao-nutri">
        <h5>Descrever características do alimento</h5>
        <p>{{ solicitacao.caracteristicas_do_alimento|safe }}</p>
        <p style="color: red">Os Produtos (Alimentos) devem ser adquiridos utilizando a verba PTRF ou outro recurso disponível.</p>
      </div>
    {% endif %}
    <div class="bloco-identificacao-nutri">
        {% if solicitacao.registro_funcional_nutricionista %}
          <h5>Identificação do Nutricionista</h5>
          <div>
            <p style="text-transform: uppercase">{{ solicitacao.registro_funcional_nutricionista }}</p>
          </div>
        {% endif %}
    </div>
    {% include "bloco_historico_questionamento.html" %}
  </div>
{% endblock %}
